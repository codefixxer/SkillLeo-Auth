<!-- page 6 -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Education - ProMatch</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>

  <style>
    :root {
      /* Design tokens (same as page 5) */
      --primary: #0061FF;
      --dark: #000000;
      --white: #FFFFFF;

      --gray-900: #111111;
      --gray-700: #404040;
      --gray-500: #737373;
      --gray-300: #E5E7EB;
      --gray-100: #F9FAFB;

      --error: #EF4444;
      --success: #10B981;

      --shadow-sm: 0 2px 8px rgba(0,0,0,0.06);
      --shadow-md: 0 8px 24px rgba(0,0,0,0.08);
      --shadow-lg: 0 12px 40px rgba(0,0,0,0.12);
    }

    /* (kept for gradient button parity used in page 5 add button styles) */
    :root{
      --primary: #0066CC;
      --primary-hover: #0052A3;
      --secondary: #F3F6FF;
      --accent: #00A0DC;
      --text-primary: #1D2129;
      --text-secondary: #65676B;
      --text-muted: #8A8D91;
      --bg: #FFFFFF;
      --bg-secondary: #F8F9FA;
      --border: #DADDE1;
      --border-light: #E4E6EA;
      --success: #42B883;
      --danger: #EF4444;
      --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
      --shadow-md: 0 4px 20px rgba(0,0,0,0.12);
      --shadow-lg: 0 8px 40px rgba(0,0,0,0.15);
      --gradient: linear-gradient(135deg, #0066CC 0%, #00A0DC 100%);
      --gradient-light: linear-gradient(135deg, rgba(0, 102, 204, 0.1) 0%, rgba(0, 160, 220, 0.1) 100%);
    }

    /* Reset */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      color: var(--gray-900);
      background: var(--white);
      -webkit-font-smoothing: antialiased;
      line-height: 1.5;
      overflow-x: hidden;
    }

    /* Background (particles canvas + floating shapes) */
    .bg-canvas {
      position: fixed; inset: 0; width: 100%; height: 100%;
      z-index: -1; opacity: 0.02;
    }
    .bg-decoration {
      position: fixed; inset: 0; width: 100%; height: 100%;
      pointer-events: none; z-index: -2;
    }
    .floating-shape {
      position: absolute; border-radius: 50%; will-change: transform, opacity; filter: blur(6px);
      background:
        radial-gradient(circle at 30% 30%, rgba(0, 97, 255, 0.22), rgba(0, 97, 255, 0.10) 45%, transparent 65%),
        radial-gradient(circle at 70% 70%, rgba(0, 97, 255, 0.18), transparent 60%);
      animation: floatBlob 14s ease-in-out infinite; opacity: .6;
    }
    .floating-shape:nth-child(1){ --size:280px; width:var(--size); height:var(--size); top:10%; right:12%; animation-delay:0s; }
    .floating-shape:nth-child(2){ --size:200px; width:var(--size); height:var(--size); bottom:20%; left:8%; animation-delay:4.2s; }
    .floating-shape:nth-child(3){ --size:150px; width:var(--size); height:var(--size); top:56%; right:28%; animation-delay:8.4s; }
    @keyframes floatBlob {
      0%,100% { transform: translate3d(0,0,0) scale(1) rotate(0deg); opacity: .55; }
      25%     { transform: translate3d(-12px,-22px,0) scale(1.03) rotate(8deg); opacity: .65; }
      50%     { transform: translate3d(0,-14px,0) scale(.98) rotate(0deg); opacity: .60; }
      75%     { transform: translate3d(12px,-28px,0) scale(1.04) rotate(-8deg); opacity: .68; }
    }

    /* Header (same as page 5) */
    .header {
      position: fixed; top: 0; left: 0; right: 0;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--gray-300);
      z-index: 100;
    }
    .header__inner {
      max-width: 1200px; margin: 0 auto; padding: 16px 24px;
      display: flex; align-items: center; justify-content: space-between; min-height: 64px;
    }
    .logo { height: 28px; width: auto; display: block; }

    .progress-container { display: flex; align-items: center; gap: 12px; font-size: 13px; color: var(--gray-500); font-weight: 500; }
    .progress-bar { width: 120px; height: 6px; background: var(--gray-300); border-radius: 3px; overflow: hidden; }
    .progress-fill { height: 100%; background: var(--dark); transition: width .6s ease; width: 62.5%; } /* default; JS will set to 75% for step 6 */

    /* Layout (same as page 5) */
    .container {
      max-width: 640px; margin: 0 auto;
      padding: 100px 24px 40px; /* space for fixed header */
      min-height: 100vh; display: flex; align-items: center;
    }
    .form-card {
      width: 100%; background: rgba(255,255,255,0.98); backdrop-filter: blur(20px);
      border: 1px solid var(--gray-300); border-radius: 16px; padding: 40px;
      box-shadow: var(--shadow-sm); animation: slideUp .6s ease-out;
    }
    @keyframes slideUp { from { opacity:0; transform: translateY(20px);} to { opacity:1; transform:none;} }

    .form-header { margin-bottom: 32px; }
    .step-badge {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 6px 14px; background: var(--gray-100); color: var(--gray-700);
      border-radius: 20px; font-size: 13px; font-weight: 500; margin-bottom: 16px;
    }
    .step-badge::before { content: ''; width: 6px; height: 6px; background: var(--primary); border-radius: 50%; animation: pulse 2s ease-in-out infinite; }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.5} }

    .form-title { font-size: 28px; font-weight: 700; color: var(--dark); margin-bottom: 8px; letter-spacing: -0.02em; }
    .form-subtitle { font-size: 15px; color: var(--gray-500); }

    /* Skip (same as page 5) */
    .skip-section {
      background: var(--gray-100);
      border: 1px dashed var(--gray-300);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      margin-bottom: 20px;
      color: var(--gray-700);
      font-size: 14px;
    }
    .skip-btn {
      margin-top: 10px;
      background: var(--white);
      border: 1px solid var(--gray-300);
      color: var(--gray-700);
      padding: 10px 14px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 13px;
      transition: all .2s ease;
    }
    .skip-btn:hover { border-color: var(--dark); background: var(--gray-100); color: var(--dark); }
    .skip-btn:focus-visible { outline: 3px solid rgba(0,97,255,.35); outline-offset: 2px; }
    .skip-btn:active { transform: translateY(0.5px); }

    /* List + empty state (names adjusted for education) */
    .education-list { margin: 24px 0; }
    .empty-state {
      border: 2px dashed var(--gray-300);
      border-radius: 12px; padding: 28px; text-align: center; color: var(--gray-500); font-size: 14px;
    }
    .empty-state .empty-icon { font-size: 42px; margin-bottom: 8px; opacity: .7; }
    .empty-state .empty-title { font-weight: 700; color: var(--gray-900); margin-bottom: 4px; }

    /* Card styles (identical look to page 5's project-card) */
    .edu-card {
      border: 1px solid var(--gray-300);
      border-radius: 12px; padding: 20px; background: var(--white);
      box-shadow: 0 6px 20px rgba(0,0,0,0.03);
      position: relative; margin-bottom: 14px;
      transition: transform .2s ease, box-shadow .2s ease, border-color .2s ease;
      animation: cardAppear .5s ease;
    }
    @keyframes cardAppear { from {opacity:0; transform: translateY(12px);} to {opacity:1; transform:none;} }
    .display-card { background: var(--gray-100); }
    .display-card:hover { transform: translateY(-1px); box-shadow: 0 10px 28px rgba(0,0,0,0.06); border-color: var(--gray-300); }

    .card-actions {
      position:absolute; top:10px; right:10px; display:flex; gap:8px; z-index:2;
      background: rgba(255,255,255,0.8); border:1px solid var(--gray-300); border-radius:10px; backdrop-filter: blur(6px); padding:4px;
    }
    .card-edit, .card-remove {
      width:30px; height:30px; display:inline-flex; align-items:center; justify-content:center;
      border:1px solid var(--gray-300); background: var(--white);
      border-radius:8px; cursor:pointer; transition: background .2s ease, color .2s ease, transform .15s ease, border-color .2s ease;
      line-height: 0;
    }
    .card-edit:hover { background: var(--dark); color: var(--white); border-color: var(--dark); }
    .card-edit:focus-visible, .card-remove:focus-visible { outline: 3px solid rgba(0,97,255,.35); outline-offset: 2px; }
    .card-remove { border-radius: 50%; color:#DC2626; background:#FEE2E2; border-color:#FCA5A5; }
    .card-remove:hover { background:#DC2626; color:#fff; border-color:#DC2626; }
    .card-remove:active, .card-edit:active { transform: translateY(0.5px); }

    .card-header { padding-right: 96px; margin-bottom: 10px; }
    .card-title { font-weight: 700; color: var(--gray-900); font-size: 16px; }
    .card-sub { margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--gray-300); font-size: 14px; color: var(--gray-700); }
    .card-footer { display:flex; align-items:center; justify-content: space-between; padding-top: 10px; }
    .card-pill { font-size: 11px; color: var(--gray-500); background: var(--white); padding: 4px 8px; border-radius: 12px; border: 1px solid var(--gray-300); }

    /* Edit state + inputs (same as page 5) */
    .edit-card { border: 1px solid var(--dark); }
    .form-group { margin-bottom: 16px; }
    .form-label { display:block; font-size:14px; font-weight:500; color: var(--gray-700); margin-bottom: 8px; }
    .required { color: var(--error); }

    .form-input {
      width: 100%; padding: 12px 14px; border: 1px solid var(--gray-300); border-radius: 8px;
      font-size: 15px; font-family: inherit; background: var(--white); transition: all .2s ease; min-height: 44px;
    }
    .form-input:hover { border-color: #d1d5db; }
    .form-input:focus { outline: none; border-color: var(--dark); box-shadow: 0 0 0 3px rgba(0,0,0,0.05); }
    .form-input:focus-visible { outline: 3px solid rgba(0,97,255,.35); outline-offset: 2px; }

    .form-header-actions { display:flex; gap:8px; justify-content:flex-end; margin-bottom: 12px; }
    .save-btn, .cancel-btn {
      padding: 10px 14px; border-radius: 10px; font-weight: 700; font-size: 13px; display: inline-flex; align-items: center; gap: 6px;
      transition: transform .15s ease, background .2s ease, color .2s ease, filter .2s ease; border: none; cursor: pointer;
    }
    .save-btn { background: var(--success); color: #fff; }
    .save-btn:hover { filter: brightness(0.95); transform: translateY(-1px); }
    .cancel-btn { background: var(--white); color: var(--gray-700); border: 1px solid var(--gray-300); }
    .cancel-btn:hover { background: var(--gray-100); }
    .save-btn:focus-visible, .cancel-btn:focus-visible { outline: 3px solid rgba(0,97,255,.35); outline-offset: 2px; }

    /* Footer actions + generic buttons (same as page 5) */
    .form-actions {
      display: flex; justify-content: space-between; align-items: center;
      margin-top: 28px; padding-top: 20px; border-top: 1px solid var(--gray-300);
    }
    .btn {
      padding: 12px 24px; border-radius: 10px; font-weight: 700; font-size: 15px;
      cursor: pointer; border: none;
      display: inline-flex; align-items: center; gap: 8px;
      transition: transform .15s ease, box-shadow .2s ease, background .2s ease, color .2s ease, filter .2s ease;
    }
    .btn:focus-visible { outline: 3px solid rgba(0,97,255,.35); outline-offset: 2px; }
    .btn:active { transform: translateY(0.5px); }
    .btn-back { background: var(--white); color: var(--gray-700); border: 1px solid var(--gray-300); }
    .btn-back:hover { border-color: var(--gray-700); background: var(--gray-100); }
    .btn-primary { background: var(--dark); color: #fff; min-width: 120px; justify-content: center; }
    .btn-primary:hover:not(:disabled) { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    .btn-primary:disabled { opacity: .35; cursor: not-allowed; transform: none; }

    /* Loaders */
    .loading-spinner {
      width: 16px; height: 16px; border: 2px solid transparent; border-top: 2px solid currentColor;
      border-radius: 50%; animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* A11y helper */
    .sr-only {
      position: absolute !important; width:1px; height:1px; padding:0; margin:-1px;
      overflow:hidden; clip: rect(0,0,1px,1px); white-space:nowrap; border:0;
    }

    /* Mobile (same as page 5) */
    @media (max-width: 640px) {
      .container { padding: 80px 16px 24px; }
      .form-card { padding: 32px 24px; }
      .form-title { font-size: 24px; }
      .form-actions { flex-direction: column-reverse; gap: 12px; }
      .btn { width: 100%; justify-content: center; }
      .floating-shape { opacity: .05; }
      .card-header { padding-right: 76px; }
    }

    /* Add Button (kept identical to page 5's gradient CTA) */
    .add-project-btn {
      width: 100%;
      padding: 16px 24px;
      background: var(--gradient);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 12px;
      transition: all 0.3s ease;
    }
    .add-project-btn:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }
  </style>
</head>
<body>
  <!-- Background -->
  <canvas class="bg-canvas" id="bgCanvas" aria-hidden="true"></canvas>
  <div class="bg-decoration" aria-hidden="true">
    <div class="floating-shape"></div>
    <div class="floating-shape"></div>
    <div class="floating-shape"></div>
  </div>

  <!-- Header (exact structure as page 5) -->
  <header class="header">
    <div class="header__inner">
      <picture>
        <source media="(max-width: 768px)" srcset="../logos/rm-bg/icon1.png"/>
        <img class="logo" src="../logos/rm-bg/logo1.png" alt="ProMatch"/>
      </picture>

      <div class="progress-container" aria-live="polite">
        <span id="stepText">Step 6 of 8</span>
        <div class="progress-bar" aria-hidden="true">
          <div class="progress-fill" id="headerProgress"></div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main (same layout/structure as page 5) -->
  <main class="container">
    <section class="form-card" aria-labelledby="education-title">
      <div class="form-header">
        <div class="step-badge">Education</div>
        <h1 class="form-title" id="education-title">Academic background</h1>
        <p class="form-subtitle">Add your educational qualifications to build credibility with clients.</p>
      </div>

      <form id="educationForm" novalidate>
        <!-- Skip -->
        <div class="skip-section">
          Education is optional but highly recommended for better visibility.
          <div><button type="button" class="skip-btn" id="skipBtn">Skip for now</button></div>
        </div>

        <!-- List -->
        <div class="education-list" id="educationList">
          <div class="empty-state" id="emptyState">
            <div class="empty-icon">📚</div>
            <div class="empty-title">Add your first education</div>
            <div class="empty-subtitle">Start with your highest qualification</div>
          </div>
        </div>

        <!-- Add button (kept identical style) -->
        <button type="button" class="add-project-btn" id="addEduBtn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        Add education
        </button>

        <!-- Actions (same structure/buttons as page 5) -->
        <div class="form-actions">
          <a href="/onboarding/portfolio" class="btn btn-back" id="backBtn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M19 12H5M12 19l-7-7 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Back
          </a>

          <button type="submit" class="btn btn-primary" id="continueBtn" disabled>
            <span id="btnText">Continue</span>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M5 12h14M12 5l7 7-7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
      </form>
    </section>
  </main>

  <!-- Subtle particle background (same as page 5) -->
  <script>
    (() => {
      const canvas = document.getElementById('bgCanvas');
      const ctx = canvas.getContext('2d');
      let w, h, particles = [];
      const COUNT = 30;

      function size(){ w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight; }
      size(); window.addEventListener('resize', size);

      class P {
        constructor(init=false){ this.reset(init); }
        reset(init){ this.x = init?Math.random()*w:(Math.random()<0.5?0:w); this.y = Math.random()*h; this.s = Math.random()*2+0.5; this.vx = Math.random()*0.5-0.25; this.vy = Math.random()*0.5-0.25; }
        step(){ this.x+=this.vx; this.y+=this.vy; if (this.x>w||this.x<0||this.y>h||this.y<0) this.reset(); }
        draw(){ ctx.fillStyle='#000'; ctx.beginPath(); ctx.arc(this.x,this.y,this.s,0,Math.PI*2); ctx.fill(); }
      }
      for (let i=0;i<COUNT;i++) particles.push(new P(true));

      function tick(){
        ctx.clearRect(0,0,w,h);
        particles.forEach(p=>{ p.step(); p.draw(); });
        for(let i=0;i<particles.length;i++){
          for(let j=i+1;j<particles.length;j++){
            const a=particles[i], b=particles[j];
            const d=Math.hypot(a.x-b.x, a.y-b.y);
            if(d<100){ ctx.strokeStyle=`rgba(0,0,0,${1-d/100})`; ctx.lineWidth=0.3; ctx.beginPath(); ctx.moveTo(a.x,a.y); ctx.lineTo(b.x,b.y); ctx.stroke(); }
          }
        }
        requestAnimationFrame(tick);
      }
      if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) tick();
    })();
  </script>

  <!-- Education logic (mirrors page 5 structure/UX) -->
  <script>
    (() => {
      "use strict";

      // DOM
      const listEl = document.getElementById('educationList');
      const emptyState = document.getElementById('emptyState');
      const addBtn = document.getElementById('addEduBtn');
      const continueBtn = document.getElementById('continueBtn');
      const btnText = document.getElementById('btnText');
      const skipBtn = document.getElementById('skipBtn');
      const stepText = document.getElementById('stepText');
      const headerProgress = document.getElementById('headerProgress');
      const formEl = document.getElementById('educationForm');

      // Progress (same behavior)
      const CURRENT_STEP = 6, TOTAL_STEPS = 8;
      function updateProgress(step){
        const pct = (step / TOTAL_STEPS) * 100;
        headerProgress.style.width = pct + '%';
        stepText.textContent = `Step ${step} of ${TOTAL_STEPS}`;
      }

      // State
      let educations = [];
      let educationIdCounter = 0;
      let editingId = null;

      // Storage
      function saveAll(){
        try { localStorage.setItem('onboarding_education', JSON.stringify(educations)); } catch {}
      }
      function loadAll(){
        try {
          const raw = localStorage.getItem('onboarding_education');
          if (!raw) return;
          const arr = JSON.parse(raw);
          if (Array.isArray(arr)) {
            educations = arr.map(e => ({
              id: Number(e?.id) || ++educationIdCounter,
              school: String(e?.school || ''),
              degree: String(e?.degree || ''),
              grade: String(e?.grade || '')
            }));
            educationIdCounter = educations.reduce((m,p)=> Math.max(m, p.id), educationIdCounter);
          }
        } catch {}
      }

      // Render
      function render(){
        listEl.innerHTML = '';
        if (!educations.length) {
          emptyState.style.display = 'block';
          listEl.appendChild(emptyState);
          updateContinueState();
          saveAll();
          return;
        }
        emptyState.style.display = 'none';
        educations.forEach(e => {
          listEl.insertAdjacentHTML('beforeend', (editingId === e.id) ? renderEdit(e) : renderCard(e));
        });
        updateContinueState();
        saveAll();
      }

      function renderCard(e){
        const school = e.school || 'School / University';
        const degree = e.degree || 'Degree';
        const grade  = e.grade ? `<span class="card-pill">${esc(e.grade)}</span>` : '<span></span>';
        return `
          <div class="edu-card display-card" id="edu-${e.id}">
            <div class="card-actions">
              <button type="button" class="card-edit" title="Edit" onclick="editEducation(${e.id})" aria-label="Edit education">✎</button>
              <button type="button" class="card-remove" title="Remove" onclick="removeEducation(${e.id})" aria-label="Remove education">×</button>
            </div>
            <div class="card-header">
              <div class="card-title">${esc(school)}</div>
              <div class="card-sub">${esc(degree)}</div>
            </div>
            <div class="card-footer">
              <span style="opacity:.6;font-size:12px;">Education entry</span>
              ${grade}
            </div>
          </div>
        `;
      }

      function renderEdit(e){
        return `
          <div class="edu-card edit-card" id="edu-${e.id}">
            <div class="form-header-actions">
              <button type="button" class="save-btn" onclick="saveEducation(${e.id})">✓ Save</button>
              <button type="button" class="cancel-btn" onclick="cancelEdit(${e.id})">Cancel</button>
            </div>

            <div class="form-group">
              <label class="form-label">School / University <span class="required">*</span></label>
              <input class="form-input" value="${escAttr(e.school)}" data-id="${e.id}" data-field="school" placeholder="University of Oxford"/>
            </div>

            <div class="form-group">
              <label class="form-label">Degree <span class="required">*</span></label>
              <input class="form-input" value="${escAttr(e.degree)}" data-id="${e.id}" data-field="degree" placeholder="Bachelor of Computer Science"/>
            </div>

            <div class="form-group">
              <label class="form-label">Grade / Score (optional)</label>
              <input class="form-input" value="${escAttr(e.grade)}" data-id="${e.id}" data-field="grade" placeholder="3.8 GPA, 85%, First Class, etc."/>
            </div>
          </div>
        `;
      }

      // CRUD
      function addEducation(){
        const id = ++educationIdCounter;
        educations.unshift({ id, school:'', degree:'', grade:'' });
        editingId = id;
        render();
        setTimeout(() => {
          const first = document.querySelector(`#edu-${id} .form-input[data-field="school"]`) || document.querySelector(`#edu-${id} .form-input`);
          if (first) first.focus();
        }, 60);
      }
      function editEducation(id){ editingId = id; render(); }
      function removeEducation(id){
        educations = educations.filter(x => x.id !== id);
        if (editingId === id) editingId = null;
        render();
      }
      function cancelEdit(id){
        const e = educations.find(x => x.id === id);
        if (e && !e.school && !e.degree && !e.grade) removeEducation(id);
        else { editingId = null; render(); }
      }
      function saveEducation(id){
        const e = educations.find(x => x.id === id);
        if (!e) return;
        if (!e.school.trim() || !e.degree.trim()){
          alert('Please fill in both School and Degree.');
          return;
        }
        editingId = null;
        saveAll();
        render();
      }

      function updateEducationField(id, field, value){
        const e = educations.find(x => x.id === id);
        if (!e) return;
        e[field] = value;
      }

      // Delegated inputs
      listEl.addEventListener('input', (ev) => {
        const el = ev.target;
        if (!el.dataset?.field) return;
        updateEducationField(Number(el.dataset.id), el.dataset.field, el.value);
        saveAll();
      });

      // Buttons / submit / skip
      function updateContinueState(){ continueBtn.disabled = (editingId != null); }
      function advanceToNextStep(){
        btnText.innerHTML = '<span class="loading-spinner"></span>';
        continueBtn.disabled = true;
        updateProgress(CURRENT_STEP + 1);
        setTimeout(() => {
          try { window.location.href = '/onboarding/preferences'; }
          catch { alert('Saved! Moving to Preferences…'); }
        }, 700);
      }

      addBtn.addEventListener('click', addEducation);
      skipBtn.addEventListener('click', () => advanceToNextStep());

      formEl.addEventListener('submit', (e) => {
        e.preventDefault();
        if (editingId != null){
          const ok = confirm('You have unsaved changes. Discard and continue?');
          if (!ok) return;
        }
        saveAll();
        advanceToNextStep();
      });

      // Expose handlers for inline buttons (same pattern as page 5)
      window.editEducation = editEducation;
      window.removeEducation = removeEducation;
      window.saveEducation = saveEducation;
      window.cancelEdit = cancelEdit;

      // Utils
      const esc = s => String(s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
      const escAttr = s => esc(s).replace(/"/g,'&quot;');

      // Init
      document.addEventListener('DOMContentLoaded', () => {
        updateProgress(CURRENT_STEP);
        loadAll();
        render();
      });
    })();
  </script>
</body>
</html>
