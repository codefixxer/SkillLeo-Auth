<!-- page 8 -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Review & Publish â€“ ProMatch</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>

  <style>
    :root {
      /* Page 5 design tokens (kept for perfect visual match) */
      --primary: #0061FF;
      --dark: #000000;
      --white: #FFFFFF;

      --gray-900: #111111;
      --gray-700: #404040;
      --gray-500: #737373;
      --gray-300: #E5E7EB;
      --gray-100: #F9FAFB;

      --error: #EF4444;
      --success: #10B981;

      --shadow-sm: 0 2px 8px rgba(0,0,0,0.06);
      --shadow-md: 0 8px 24px rgba(0,0,0,0.08);
      --shadow-lg: 0 12px 40px rgba(0,0,0,0.12);
    }

    /* (also keep the secondary token set used across steps) */
    :root{
      --primary-2: #0066CC;
      --primary-hover: #0052A3;
      --secondary: #F3F6FF;
      --accent: #00A0DC;
      --text-primary: #1D2129;
      --text-secondary: #65676B;
      --text-muted: #8A8D91;
      --bg: #FFFFFF;
      --bg-secondary: #F8F9FA;
      --border: #DADDE1;
      --border-light: #E4E6EA;
      --gradient: linear-gradient(135deg, #0066CC 0%, #00A0DC 100%);
      --gradient-light: linear-gradient(135deg, rgba(0, 102, 204, 0.08) 0%, rgba(0, 160, 220, 0.08) 100%);
    }

    /* Reset / base */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      color: var(--gray-900);
      background: var(--white);
      -webkit-font-smoothing: antialiased;
      line-height: 1.5;
      overflow-x: hidden;
    }

    /* Background (particles canvas + floating shapes) */
    .bg-canvas {
      position: fixed; inset: 0; width: 100%; height: 100%;
      z-index: -1; opacity: 0.02;
    }
    .bg-decoration {
      position: fixed; inset: 0; width: 100%; height: 100%;
      pointer-events: none; z-index: -2;
    }
    .floating-shape {
      position: absolute; border-radius: 50%; will-change: transform, opacity; filter: blur(6px);
      background:
        radial-gradient(circle at 30% 30%, rgba(0, 97, 255, 0.22), rgba(0, 97, 255, 0.10) 45%, transparent 65%),
        radial-gradient(circle at 70% 70%, rgba(0, 97, 255, 0.18), transparent 60%);
      animation: floatBlob 14s ease-in-out infinite; opacity: .6;
    }
    .floating-shape:nth-child(1){ --size:260px; width:var(--size); height:var(--size); top:12%; right:12%; animation-delay:0s; }
    .floating-shape:nth-child(2){ --size:200px; width:var(--size); height:var(--size); bottom:22%; left:8%; animation-delay:4.2s; }
    .floating-shape:nth-child(3){ --size:160px; width:var(--size); height:var(--size); top:58%; right:26%; animation-delay:8.4s; }
    @keyframes floatBlob {
      0%,100% { transform: translate3d(0,0,0) scale(1) rotate(0deg); opacity: .55; }
      25%     { transform: translate3d(-12px,-22px,0) scale(1.03) rotate(8deg); opacity: .65; }
      50%     { transform: translate3d(0,-14px,0) scale(.98) rotate(0deg); opacity: .60; }
      75%     { transform: translate3d(12px,-28px,0) scale(1.04) rotate(-8deg); opacity: .68; }
    }

    /* Header (exactly like step 5) */
    .header {
      position: fixed; top: 0; left: 0; right: 0;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--gray-300);
      z-index: 100;
    }
    .header__inner {
      max-width: 1200px; margin: 0 auto; padding: 16px 24px;
      display: flex; align-items: center; justify-content: space-between; min-height: 64px;
    }
    .logo { height: 28px; width: auto; display: block; }

    .progress-container { display: flex; align-items: center; gap: 12px; font-size: 13px; color: var(--gray-500); font-weight: 500; }
    .progress-bar { width: 120px; height: 6px; background: var(--gray-300); border-radius: 3px; overflow: hidden; }
    .progress-fill { height: 100%; background: var(--dark); transition: width .6s ease; width: 100%; }

    /* Layout (same spacing as step 5) */
    .container {
      max-width: 640px; margin: 0 auto;
      padding: 100px 24px 40px; /* space for fixed header */
      min-height: 100vh; display: flex; align-items: center;
    }
    .form-card {
      width: 100%; background: rgba(255,255,255,0.98); backdrop-filter: blur(20px);
      border: 1px solid var(--gray-300); border-radius: 16px; padding: 40px;
      box-shadow: var(--shadow-sm); animation: slideUp .6s ease-out;
    }
    @keyframes slideUp { from { opacity:0; transform: translateY(20px);} to { opacity:1; transform:none;} }

    .form-header { margin-bottom: 32px; text-align: left; }
    .step-badge {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 6px 14px; background: var(--gray-100); color: var(--gray-700);
      border-radius: 20px; font-size: 13px; font-weight: 500; margin-bottom: 16px;
    }
    .step-badge::before { content: ''; width: 6px; height: 6px; background: var(--primary); border-radius: 50%; animation: pulse 2s ease-in-out infinite; }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.5} }

    .form-title { font-size: 28px; font-weight: 700; color: var(--dark); margin-bottom: 8px; letter-spacing: -0.02em; }
    .form-subtitle { font-size: 15px; color: var(--gray-500); }

    /* Preview blocks (match card treatment from step 5) */
    .summary-card {
      border: 1px solid var(--gray-300);
      border-radius: 12px; padding: 20px; background: var(--gray-100);
      box-shadow: 0 6px 20px rgba(0,0,0,0.03);
      margin-bottom: 16px;
      transition: transform .2s ease, box-shadow .2s ease, border-color .2s ease;
    }
    .summary-card:hover { transform: translateY(-1px); box-shadow: 0 10px 28px rgba(0,0,0,0.06); border-color: var(--gray-300); }

    .profile-header {
      display: grid; grid-template-columns: 64px 1fr; gap: 14px; align-items: center; margin-bottom: 12px;
      border-bottom: 1px solid var(--gray-300); padding-bottom: 12px;
    }
    .avatar {
      width: 64px; height: 64px; border-radius: 50%;
      display: grid; place-items: center; font-weight: 700; color: #fff; font-size: 20px;
      background: var(--dark);
    }
    .ph-name { font-weight: 700; color: var(--gray-900); }
    .ph-sub { font-size: 13px; color: var(--gray-500); }

    .chips { display:flex; flex-wrap: wrap; gap: 8px; }
    .chip {
      font-size: 12px; color: var(--gray-700); background: var(--white);
      border: 1px solid var(--gray-300); padding: 6px 10px; border-radius: 999px; display:inline-flex; gap:6px; align-items:center;
    }
    .chip .lvl { font-size: 11px; background: var(--gray-100); border:1px solid var(--gray-300); padding: 2px 6px; border-radius: 999px; }

    .stats { display:grid; grid-template-columns: repeat(3,1fr); gap: 12px; margin-top: 8px; }
    .stat {
      background: var(--white); border:1px solid var(--gray-300); border-radius: 10px; padding: 12px; text-align:center;
    }
    .stat .n { font-weight: 800; color: var(--gray-900); }
    .stat .l { font-size: 12px; color: var(--gray-500); }

    /* Toggle row (borrowed from step 7 styles) */
    .toggle-row {
      display:flex; align-items:center; justify-content: space-between;
      padding: 14px 16px; background: var(--white); border: 1px solid var(--gray-300); border-radius: 12px;
    }
    .toggle-info { color: var(--gray-700); font-size: 14px; }
    .switch { position: relative; width: 46px; height: 24px; }
    .switch input { opacity:0; width:0; height:0; }
    .slider {
      position:absolute; inset:0; background: var(--gray-300); border-radius: 999px; transition: .25s;
    }
    .slider:before {
      content:""; position:absolute; width:18px; height:18px; left:3px; top:3px; background:#fff; border-radius:50%;
      box-shadow: 0 2px 4px rgba(0,0,0,.2); transition: .25s;
    }
    .switch input:checked + .slider { background: var(--dark); }
    .switch input:checked + .slider:before { transform: translateX(22px); }

    /* Footer actions + generic buttons (same as step 5) */
    .form-actions {
      display: flex; justify-content: space-between; align-items: center;
      margin-top: 28px; padding-top: 20px; border-top: 1px solid var(--gray-300);
    }
    .btn {
      padding: 12px 24px; border-radius: 10px; font-weight: 700; font-size: 15px;
      cursor: pointer; border: none;
      display: inline-flex; align-items: center; gap: 8px;
      transition: transform .15s ease, box-shadow .2s ease, background .2s ease, color .2s ease, filter .2s ease;
    }
    .btn:focus-visible { outline: 3px solid rgba(0,97,255,.35); outline-offset: 2px; }
    .btn:active { transform: translateY(0.5px); }
    .btn-back { background: var(--white); color: var(--gray-700); border: 1px solid var(--gray-300); }
    .btn-back:hover { border-color: var(--gray-700); background: var(--gray-100); }
    .btn-primary { background: var(--dark); color: #fff; min-width: 160px; justify-content: center; }
    .btn-primary:hover:not(:disabled) { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    .btn-primary:disabled { opacity: .35; cursor: not-allowed; transform: none; }

    /* Toast */
    .toast {
      position: fixed; top: 20px; right: 20px; background: var(--dark); color: #fff;
      padding: 12px 16px; border-radius: 10px; font-size: 13px; box-shadow: var(--shadow-lg); z-index: 9999;
      animation: toastIn .2s ease;
    }
    @keyframes toastIn { from{opacity:0; transform: translateY(-6px);} to{opacity:1; transform:none;} }

    /* Mobile */
    @media (max-width: 640px) {
      .container { padding: 80px 16px 24px; }
      .form-card { padding: 32px 24px; }
      .form-title { font-size: 24px; }
      .form-actions { flex-direction: column-reverse; gap: 12px; }
      .btn { width: 100%; justify-content: center; }
      .floating-shape { opacity: .05; }
      .stats { grid-template-columns: 1fr; }
    }
    .sr-only {
      position: absolute !important; width:1px; height:1px; padding:0; margin:-1px;
      overflow:hidden; clip: rect(0,0,1px,1px); white-space:nowrap; border:0;
    }
  </style>
</head>
<body>
  <!-- Subtle Particles -->
  <canvas class="bg-canvas" id="bgCanvas" aria-hidden="true"></canvas>
  <div class="bg-decoration" aria-hidden="true">
    <div class="floating-shape"></div>
    <div class="floating-shape"></div>
    <div class="floating-shape"></div>
  </div>

  <!-- Header -->
  <header class="header">
    <div class="header__inner">
      <picture>
        <source media="(max-width: 768px)" srcset="../logos/rm-bg/icon1.png"/>
        <img class="logo" src="../logos/rm-bg/logo1.png" alt="ProMatch"/>
      </picture>

      <div class="progress-container" aria-live="polite">
        <span id="stepText">Step 8 of 8</span>
        <div class="progress-bar" aria-hidden="true">
          <div class="progress-fill" id="headerProgress" style="width:100%"></div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="container">
    <section class="form-card" aria-labelledby="review-title">
      <div class="form-header">
        <div class="step-badge">Review &amp; Publish</div>
        <h1 class="form-title" id="review-title">Your profile is ready to shine</h1>
        <p class="form-subtitle">Give it a quick look, toggle visibility, and publish.</p>
      </div>

      <!-- Profile summary -->
      <div class="summary-card" id="profileSummary">
        <div class="profile-header">
          <div class="avatar" id="profileAvatar" aria-hidden="true">U</div>
          <div>
            <div class="ph-name" id="profileName">Your Name</div>
            <div class="ph-sub">
              <span id="profileLocation">Your Location</span> Â·
              <span id="profileUrl">promatch.com/username</span>
            </div>
          </div>
        </div>

        <div class="chips" id="skillsChips" aria-label="Top skills"></div>

        <div class="stats" role="group" aria-label="Profile stats">
          <div class="stat">
            <div class="n" id="skillsCount">0</div>
            <div class="l">Skills</div>
          </div>
          <div class="stat">
            <div class="n" id="experienceCount">0</div>
            <div class="l">Experience</div>
          </div>
          <div class="stat">
            <div class="n" id="projectsCount">0</div>
            <div class="l">Projects</div>
          </div>
        </div>
      </div>

      <!-- Visibility -->
      <div class="summary-card">
        <div class="toggle-row">
          <div class="toggle-info">
            <strong>Make profile public</strong><br/>
            <span class="ph-sub">Your profile will be visible to clients and searchable.</span>
          </div>
          <label class="switch" aria-label="Toggle public profile">
            <input type="checkbox" id="makePublic" checked />
            <span class="slider"></span>
          </label>
        </div>
      </div>

      <!-- Actions -->
      <form class="form-actions" id="reviewForm">
        <a href="/onboarding/preferences" class="btn btn-back">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M19 12H5M12 19l-7-7 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Back
        </a>

        <button type="submit" class="btn btn-primary" id="publishBtn">
          <span id="btnText">Publish profile</span>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M5 12h14M12 5l7 7-7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </form>
    </section>
  </main>

  <script>
    /* ===== Subtle particle background (same as step 5) ===== */
    (() => {
      const canvas = document.getElementById('bgCanvas');
      const ctx = canvas.getContext('2d');
      let w, h, particles = [];
      const COUNT = 30;

      function size(){ w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight; }
      size(); window.addEventListener('resize', size);

      class P {
        constructor(init=false){ this.reset(init); }
        reset(init){ this.x = init?Math.random()*w:(Math.random()<0.5?0:w); this.y = Math.random()*h; this.s = Math.random()*2+0.5; this.vx = Math.random()*0.5-0.25; this.vy = Math.random()*0.5-0.25; }
        step(){ this.x+=this.vx; this.y+=this.vy; if (this.x>w||this.x<0||this.y>h||this.y<0) this.reset(); }
        draw(){ ctx.fillStyle='#000'; ctx.beginPath(); ctx.arc(this.x,this.y,this.s,0,Math.PI*2); ctx.fill(); }
      }
      for (let i=0;i<COUNT;i++) particles.push(new P(true));

      function tick(){
        ctx.clearRect(0,0,w,h);
        particles.forEach(p=>{ p.step(); p.draw(); });
        for(let i=0;i<particles.length;i++){
          for(let j=i+1;j<particles.length;j++){
            const a=particles[i], b=particles[j];
            const d=Math.hypot(a.x-b.x, a.y-b.y);
            if(d<100){ ctx.strokeStyle=`rgba(0,0,0,${1-d/100})`; ctx.lineWidth=0.3; ctx.beginPath(); ctx.moveTo(a.x,a.y); ctx.lineTo(b.x,b.y); ctx.stroke(); }
          }
        }
        requestAnimationFrame(tick);
      }
      if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) tick();
    })();

    /* ===== Progress (consistent across steps) ===== */
    (() => {
      const CURRENT_STEP = 8, TOTAL_STEPS = 8;
      const headerProgress = document.getElementById('headerProgress');
      const stepText = document.getElementById('stepText');
      const pct = (CURRENT_STEP / TOTAL_STEPS) * 100;
      headerProgress.style.width = pct + '%';
      stepText.textContent = `Step ${CURRENT_STEP} of ${TOTAL_STEPS}`;
    })();

    /* ===== Load and render final review ===== */
    function loadProfileData() {
      const personal   = JSON.parse(localStorage.getItem('onboarding_personal')   || '{}');
      const location   = JSON.parse(localStorage.getItem('onboarding_location')   || '{}');
      const skills     = JSON.parse(localStorage.getItem('onboarding_skills')     || '[]');
      const experience = JSON.parse(localStorage.getItem('onboarding_experience') || '[]');
      const portfolio  = JSON.parse(localStorage.getItem('onboarding_portfolio')  || '[]');
      return { personal, location, skills, experience, portfolio };
    }

    function toast(msg){
      const t = document.createElement('div');
      t.className = 'toast';
      t.textContent = msg;
      document.body.appendChild(t);
      setTimeout(()=>{ t.style.opacity='0'; t.style.transform='translateY(-6px)'; setTimeout(()=> t.remove(), 200); }, 2200);
    }

    function renderReview(){
      const { personal, location, skills, experience, portfolio } = loadProfileData();

      const fullName = `${personal.firstName || ''} ${personal.lastName || ''}`.trim() || 'Your Name';
      const initials = fullName.split(' ').filter(Boolean).map(n => n[0]).join('').toUpperCase() || 'U';
      const locTxt = [location.city, location.country].filter(Boolean).join(', ') || 'Your Location';
      const urlTxt = `promatch.com/${personal.username || 'username'}`;

      document.getElementById('profileAvatar').textContent = initials;
      document.getElementById('profileName').textContent = fullName;
      document.getElementById('profileLocation').textContent = locTxt;
      document.getElementById('profileUrl').textContent = urlTxt;

      document.getElementById('skillsCount').textContent     = skills.length || 0;
      document.getElementById('experienceCount').textContent = experience.length || 0;
      document.getElementById('projectsCount').textContent   = portfolio.length || 0;

      const chips = document.getElementById('skillsChips');
      chips.innerHTML = '';
      const top = skills.slice(0, 6);
      if (top.length === 0) {
        const span = document.createElement('span');
        span.className = 'ph-sub';
        span.textContent = 'No skills added';
        chips.appendChild(span);
      } else {
        top.forEach(s => {
          const el = document.createElement('span');
          el.className = 'chip';
          el.innerHTML = `${escapeHTML(s.name)} <span class="lvl">Lv ${Number(s.level||0)}</span>`;
          chips.appendChild(el);
        });
      }
    }

    function escapeHTML(s){ return String(s || '').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m])); }

    /* ===== Publish ===== */
    document.getElementById('reviewForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const btn = document.getElementById('publishBtn');
      const btnText = document.getElementById('btnText');
      btn.disabled = true;
      const was = btnText.textContent;
      btnText.innerHTML = '<span class="sr-only">Publishingâ€¦</span>Publishingâ€¦';

      // Save final state
      const data = loadProfileData();
      const isPublic = document.getElementById('makePublic').checked;
      const profileUrl = `promatch.com/${data.personal.username || 'username'}`;
      const published = { ...data, isPublic, publishedAt: new Date().toISOString(), profileUrl };
      try { localStorage.setItem('published_profile', JSON.stringify(published)); } catch {}

      setTimeout(() => {
        toast('âœ… Profile published and ready to share');
        btnText.textContent = was;
        btn.disabled = false;
        // Navigate to dashboard (replace alert with real route in app)
        setTimeout(() => {
          try { window.location.href = '/dashboard'; }
          catch { alert(`ðŸŽ‰ Your profile is live:\n${profileUrl}`); }
        }, 600);
      }, 900);
    });

    /* Init */
    document.addEventListener('DOMContentLoaded', renderReview);
  </script>
</body>
</html>
